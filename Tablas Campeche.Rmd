---
title: "Tablas Campeche"
author: "Alys Jiménez"
date: "`r Sys.Date()`"
output: html_document
---
```{r}
library(dplyr)
library(ggplot2)
library(printr)

setwd("/Users/alysjime/Downloads")
getwd()
datos_2024 <- read.csv("Datos_molec_2024-1.csv")
datos_2023 <- read.csv("Datos_molec_2023-1.csv")
datos_2022 <- read.csv("Datos_molec_2022-1.csv")
datos_2021 <- read.csv("Datos_molec_2021-1.csv")
datos_2020 <- read.csv("Datos_molec_2020-1.csv")
datos_2019 <- read.csv("Datos_molec_2019-1.csv")
```

```{r}
#Hacer nuevas bases con solo las variables por analizar
d_2024 <- datos_2024 %>% 
  select(sexo,entidad,edad,nivel,p1,p2,p4,p10,p16,p22,p3_5,p26,p31,p33_3,p33_4,p33_1)

d_2023 <- datos_2023 %>% 
  select(sexo,entidad,edad,nivel,p1,p2,p4,p10,p16,p22,p3_5,p26,p31,p33_3,p33_4,p33_1)

d_2022 <- datos_2022 %>% 
  select(sexo,entidad,edad,nivel,p1,p2,p4,p10,p16,p22,p3_5,p26,p31,p33_3,p33_4,p33_1)

d_2021 <- datos_2021 %>% 
  select(sexo,entidad,edad,nivel,p1,p2,p4,p10,p16,p22,p3_5,p26,p31,p33_3,p33_4,p33_1)

d_2020 <- datos_2020 %>% 
  select(sexo,entidad,edad,nivel,p1,p2,p4,p10,p16,p22,p3_5,p26,p31,p33_3,p33_4,p33_1)

d_2019 <- datos_2019 %>% 
  select(sexo,entidad,edad,nivel,p1,p2,p4,p10,p16,p22,p3_5,p26,p31,p33_3,p33_4,p33_1)

```


```{r}
#Añadir columna de año para poder combinar y comparar los datos
d_2024 <- d_2024 %>% 
  mutate(anio= 2024)

d_2023 <- d_2023 %>% 
  mutate(anio= 2023)

d_2022 <- d_2022 %>% 
  mutate(anio= 2022)

d_2021 <- d_2021 %>% 
  mutate(anio= 2021)

d_2020 <- d_2020 %>% 
  mutate(anio= 2020)

d_2019 <- d_2019 %>% 
  mutate(anio= 2019)

#Combinar todos los años
datos <- bind_rows(d_2024,d_2023,d_2022,d_2021,d_2020,d_2019)
glimpse(datos)

# Calculate the percentage of missing data for specific columns
missing_summary <- datos %>%
  summarise(
    porcentaje_NA_edad = (sum(is.na(edad)) / n()) * 100,
    porcentaje_NA_anio = (sum(is.na(anio)) / n()) * 100
  )

# Print the results, rounded to 2 decimal places
print(round(missing_summary, 2))

```
```{r}
#Agrupar por generacion
datos <- datos %>%
  mutate(
    anio_de_nacimiento = anio - edad,
    generacion = case_when(
      anio_de_nacimiento >= 1997 ~ "Gen Z",
      anio_de_nacimiento >= 1981 & anio_de_nacimiento <= 1996 ~ "Millennial",
      anio_de_nacimiento >= 1965 & anio_de_nacimiento <= 1980 ~ "Gen X",
      anio_de_nacimiento <= 1964 ~ "Boomer"
    )
  ) %>%
  select(-anio_de_nacimiento)

datos %>%
  count(generacion, sort = TRUE)
```


```{r}
entidad_nombres <- data.frame(
  entidad = c("01", "02", "03", "04", "05", "06", "07", "08", "09", "10", 
              "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", 
              "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", 
              "31", "32"),
  nombre_entidad = c("Aguascalientes", "Baja California", "Baja California Sur", "Campeche", 
                     "Coahuila", "Colima", "Chiapas", "Chihuahua", "Ciudad de México", 
                     "Durango", "Guanajuato", "Guerrero", "Hidalgo", "Jalisco", 
                     "México", "Michoacán", "Morelos", "Nayarit", "Nuevo León", 
                     "Oaxaca", "Puebla", "Querétaro", "Quintana Roo", "San Luis Potosí", 
                     "Sinaloa", "Sonora", "Tabasco", "Tamaulipas", "Tlaxcala", 
                     "Veracruz", "Yucatán", "Zacatecas")
)

datos <- datos %>% mutate(entidad = formatC(entidad, width=2, flag="0"))

libros_por_entidad <- datos %>%
  filter(!is.na(p4)) %>%
  group_by(entidad) %>%
  summarize(libros_promedio = mean(p4, na.rm = TRUE), .groups = 'drop') %>%
  left_join(entidad_nombres, by = "entidad") %>%
  filter(!is.na(nombre_entidad))

ggplot(libros_por_entidad, aes(x = reorder(nombre_entidad, libros_promedio), y = libros_promedio)) +
  geom_col(aes(fill = libros_promedio)) +
  coord_flip() +
  scale_fill_gradient(low = "#a8ddb1", high = "#2b8cbe") +
  labs(
    title = "Ranking de Libros Leídos por Estado",
    subtitle = "Promedio de todos los años (2019-2024)",
    x = "Estado",
    y = "Libros Promedio Leídos"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```


```{r}

tabla_educacion_ancha <- datos %>%
  left_join(entidad_nombres, by = "entidad") %>%
  filter(
    nivel_educativo_detallado != "No sabe",
    !is.na(nivel_educativo_detallado),
    !is.na(nombre_entidad)
  ) %>%
  count(nombre_entidad, nivel_educativo_detallado, name = "total_personas") %>%
  pivot_wider(
    names_from = nivel_educativo_detallado,
    values_from = total_personas,
    values_fill = 0
  )


tabla_con_total <- tabla_educacion_ancha %>%
  mutate(
    Total_Personas = rowSums(select(., -nombre_entidad))
  ) %>%
  arrange(desc(Total_Personas))

print(tabla_con_total)
```

```{r}
tabla_porcentajes <- tabla_con_total %>%
  
  mutate(
    across(
      .cols = -c(nombre_entidad, Total_Personas),
      .fns = ~ round((. / Total_Personas) * 100, 2) 
    )
  )

print(tabla_porcentajes)
```
```{r}

campeche_datos <- data.frame(
  "Entidad federativa" = "Campeche",
  "Sexo" = "Total",
  "Total" = 248444,
  "Inicial" = 3242,
  "Preescolar" = 34356,
  "Primaria" = 100121,
  "Secundaria" = 45736,
  "Media superior" = 36601,
  "Superior" = 28388,
  check.names = FALSE
)


print("Tabla de Datos Campeche")
print(campeche_datos)

campeche_porcentajes <- campeche_datos %>%
  mutate(
    across(
      .cols = Total:Superior,
      .fns = ~ round((. / Total) * 100, 2)
    )
  )

print("Tabla de Porcentajes")
print(campeche_porcentajes)
```
